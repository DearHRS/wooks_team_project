# ============================================================================
# СЦЕНАРИЙ ПРОЛОГА: История про оцифрованное сознание
# ============================================================================
# Этот файл содержит все сцены пролога, разбитые на отдельные модули
# для удобства редактирования и переиспользования.
# ============================================================================

# ============================================================================
# ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ДЛЯ ПЕРЕХОДОВ МЕЖДУ СЦЕНАМИ
# ============================================================================
# Функция для плавного перехода между сценами с эффектом затемнения
label scene_transition(bg_name="bgBlack", duration=0.5):
    scene expression bg_name with Dissolve(duration)
    return

# Стили для авторских вставок
init -1:
    style prolog_narrator is default:
        size 36
        color "#ffffff"
        outlines [(2, "#000000", 0, 0)]

# ============================================================================
# СЦЕНА 0А: Вступление (быстрое появление текста)
# ============================================================================
# Автор рассказывает о начале истории
label prologue_scene_0a_intro:
    scene bgPrologBackground with Dissolve(0.5)
    show expression Solid("#00000080") as prolog_overlay
    centered "{=prolog_narrator}Это был обычный январский вечер, и ничего не предвещало приключений.{/=}"
    pause 0.8
    centered "{=prolog_narrator}Наш герой возвращался домой после очередного скучного дня.{/=}"
    pause 0.8
    hide prolog_overlay
    return

# ============================================================================
# СЦЕНА 0B: Дома - размышления героя
# ============================================================================
# Герой устал после учебы и решает поиграть
label prologue_scene_0b_home:
    scene bgPrologBackground with Dissolve(1.0)
    
    h "У-у-х, как же я устаю после школы и репетиторов."
    h "Экзамены всё ближе, готов я вроде неплохо, но уже очень устал от этой бесконечной рутины."
    h "Еще и родители каждый день мозги парят с выбором профессии."
    h "Ну не знаю я, блин, кем хочу стать!"
    h "Быть программистом вроде неплохо, но их сейчас так много, что фиг пойми, кем мне понравится быть."
    h "Ладно, потом еще об этом подумаю. Сейчас у меня вроде есть свободный час, хоть в комп поиграю."
    return

# ============================================================================
# СЦЕНА 0C: Выбор игры
# ============================================================================
# Герой находит и скачивает игру
label prologue_scene_0c_game_choice:
    scene bgPrologBackground with Dissolve(0.5)
    
    h "Так, что у нас из новинок игр есть? О, ретро-игрушка про космический корабль, который отбивается от пришельцев, звучит весело."
    h "Скачать и установить."
    
    show expression Solid("#00000080") as prolog_overlay
    centered "{=prolog_narrator}Загрузка{w=0.5}.{w=0.5}.{w=0.5}.{w=0.5}{nw}"
    pause 1.0
    centered "{=prolog_narrator}У{w=0.1}с{w=0.1}т{w=0.1}а{w=0.1}но{w=0.1}вка {w=0.5}завершена{w=0.5}{nw}"
    pause 0.5
    hide prolog_overlay
    
    return

# ============================================================================
# СЦЕНА 0D: После игры - встреча с хакером
# ============================================================================
# Герой проигрывает в игру, появляется хакер
label prologue_scene_0d_hacker_appears:
    scene bgPrologBackground with Dissolve(0.5)
    
    h "Эти пришельцы двигались очень странно!"
    
    # Появление хакера
    show hacker idle at right with dissolve
    pause 0.5
    
    show expression Solid("#00000080") as prolog_overlay
    centered "{=prolog_narrator}Внезапно на экране появляется профиль непонятного человека.{/=}"
    centered "{=prolog_narrator}Он не выглядит дружелюбным.{/=}"
    hide prolog_overlay
    
    x "А вот и я!"
    h "Ты читеришь! Так нельзя."
    x "Ха, пацан, тебя не учили, что когда из интернета что-то качаешь, надо на вирусы проверять!"
    x "Я хакер, а все твои файлы и данные теперь у меня!"
    x "А и еще один подарочек для тебя, я оцифрую твое сознание и запру его в компьютере."
    h "ЧЕГО!!!"
    
    # Переход в виртуальный мир
    scene bgBlack with Dissolve(1.0)
    pause 1.0
    
    return

# ============================================================================
# СЦЕНА 1: Пробуждение героя
# ============================================================================
# Герой просыпается в виртуальном мире и осознает, что его оцифровали
label prologue_scene_1_awakening:
    # Пробуждение в виртуальном мире
    scene bgMainCRT with Dissolve(0.5)
    show hero idle at center with dissolve
    
    h "Емае, че со мной случилось."
    h "{i}Неужели этот хакер и вправду смог оцифровать мое сознание через какой-то вирус!{/i}"
    h "Мне надо срочно отсюда выбираться, чтобы предупредить людей — это слишком опасно!"
    
    hide hero with dissolve
    return


# ============================================================================
# СЦЕНА 2: Встреча с помощником
# ============================================================================
# Появляется помощник и героя. Они обсуждают ситуацию.
label prologue_scene_2_meeting_assistant:
    scene bgMainCRT with dissolve
    show assistant surprised at assistantPos with dissolve
    show hero idle at right with dissolve
    
    a "Новая прошивка?"
    a "Я не видела тебя здесь раньше."
    h "Нет, я человек."
    h "Я скачал игру из интернета, а там оказался вирус, и хакер как-то смог оцифровать мое сознание через него, и я оказался здесь…"
    
    show assistant idle at assistantPos
    a "Хм, да, проблема серьезная, но я думаю, я смогу тебе помочь."
    h "Да, пожалуйста, помоги!!!"
    
    hide assistant
    hide hero
    with dissolve
    return


# ============================================================================
# СЦЕНА 3: План спасения
# ============================================================================
# Помощник объясняет план по восстановлению данных.
label prologue_scene_3_rescue_plan:
    scene bgMainCRT with dissolve
    show assistant idle at assistantPos with dissolve
    show hero idle at right with dissolve
    
    a "Тебе нужно найти этого хакера и вернуть свои данные, тогда и твое сознание вернется в тело."
    a "Не будем терять время и начнем с начала."
    a "Для начала тебе нужно провести разведку, чтобы узнать, с кем мы имеем дело."
    
    hide assistant
    hide hero
    with dissolve
    return


# ============================================================================
# СЦЕНА 4: Подключение к сети (мини-игра разведка)
# ============================================================================
# Помощник подключает героя к сети для разведки.
label prologue_scene_4_reconnaissance_prep:
    # Переход на сцену (синий — сетевая подготовка)
    scene bgMainCRT with Dissolve(0.5)
    show assistant idle at assistantPos with dissolve
    show hero idle at right with dissolve
    
    a "Ну все, теперь ты готов к тому, чтобы вычислить этого хакера! Подключаю тебя к сети!"
    a "Но сначала давай я расскажу тебе о разведке — это важный этап."
    
    # Теория разведки
    a "Начнем с базы. Разведка — это этап сбора максимального объема информации о цели для выявления слабых мест и векторов для потенциальной атаки."
    a "Есть два основных типа разведки: пассивная и активная."
    
    show assistant smile at assistantPos
    a "Начнем с пассивной. Её суть в сборе информации без прямого взаимодействия с системами цели."
    a "Она не оставляет следов в логах цели, позволяя оставаться скрытым."
    
    show assistant idle at assistantPos
    a "Вся информация берется из общедоступных данных. Например, из соц сетей, открытых реестров и сайтов с утечками."
    a "Таким образом мы собираем как можно больше информации о компании, инфраструктуре и людях."
    a "Начинать надо всегда с пассивной разведки."
    
    show assistant open at assistantPos
    a "Теперь об активной разведке. Из-за  прямого взаимодействия с инфраструктурой цели может быть обнаружена и залогирована."
    a "Но она открывает куда более широкие возможности!"
    
    show assistant idle at assistantPos
    a "Благодаря различным сканированиям можно узнать много полезной информации."
    a "Например, можно отсканировать порты, узнать какие из них открытые и какие сервисы на них работают."
    a "Так же можно провести сканирование на известные уязвимости в версиях ПО."
    
    show assistant smile at assistantPos
    a "Что ж, это, пожалуй, все, что я могу рассказать тебе о разведке. Пора за дело!"
    
    hide assistant
    hide hero
    with dissolve
    
    # Викторина: разведка
    python:
        reconnaissance_quiz = {
            "title": "РАЗВЕДКА: Основы кибербезопасности",
            "lives": 3,
            "questions": [
                ("Что является главной целью этапа разведки?", ("Немедленно взломать систему", "Собрать максимум информации о цели", "Стереть логи после атаки", "Написать финальный отчет"), 1),
                ("Какой тип разведки не оставляет прямых следов в логах?", ("Активная разведка", "Пассивная разведка", "Внутренняя разведка", "Социальная инженерия"), 1),
                ("Изучение профилей сотрудников в GitHub — это...", ("Только активная разведка", "Только пассивная разведка", "Внутренняя разведка", "Не является разведкой"), 1),
                ("Скачивание backup_2023.zip с сайта компании...", ("Всегда допустимо", "Часть пассивной разведки", "Допустимо при разрешении", "Никогда не делается"), 2),
                ("Легальная практика для тренировки навыков?", ("Сканировать случайные сайты", "Тренироваться на HackTheBox", "Сканировать банк из интереса", "Купить утекшие данные"), 1),
                ("Ключевое отличие белого хакера от злоумышленника?", ("Более крутые инструменты", "Быстрее проводит разведку", "Действует в рамках закона", "Нет отличий"), 2),
            ]
        }
    
    call quiz_game(reconnaissance_quiz)
    return


# ============================================================================
# СЦЕНА 5: Результаты разведки
# ============================================================================
# Герой вернулся из разведки, помощник подводит итоги.
label prologue_scene_5_reconnaissance_results:
    scene bgMainCRT with dissolve
    show assistant smile at assistantPos with dissolve
    show hero smile at right with dissolve
    
    a "Отлично, у тебя получилось вычислить всю необходимую информацию о хакере!"
    a "Теперь мы можем продвигаться дальше."
    
    hide assistant
    hide hero
    with dissolve
    return


# ============================================================================
# СЦЕНА 6: Появление хакера (угроза)
# ============================================================================
# Хакер обнаруживает вторжение героя и угрожает его данным.
label prologue_scene_6_hacker_threat:
    scene bgMainCRT with dissolve
    
    # Появление хакера
    show hacker idle at center with vpunch
    pause 0.5
    
    x "ТАК! Это что такое! Кто в моей системе копошится!"
    x "А это ты, что надеешься выбраться отсюда?"
    x "Ничего у тебя не получится! Твои данные уже у меня, и скоро я их отформатирую, и никто даже не вспомнит, что ты жил!"
    x "УДАЧИ."
    
    hide hacker with dissolve
    
    show hero idle at right with dissolve
    h "{i}Мне конец, что родители скажут!{/i}"
    
    show assistant idle at assistantPos with dissolve
    a "Без паники! У нас еще есть время, чтобы тебя спасти."
    a "Ты достал информацию о местоположении слабых зон в защите хакера."
    a "Нам нужно проанализировать полученную информацию."
    
    h "{i}Мне точно не успеть…{/i}"
    a "Все проще, чем ты думаешь!"
    
    hide assistant
    hide hero
    with dissolve
    return


# ============================================================================
# СЦЕНА 7: Подготовка к анализу (мини-игра анализ)
# ============================================================================
# Помощник готовит героя к анализу уязвимостей.
label prologue_scene_7_analysis_prep:
    # Переход на сцену (красный — опасность и уязвимости)
    scene bgMainCRT with Dissolve(0.5)
    show assistant idle at assistantPos with dissolve
    show hero idle at right with dissolve
    
    a "Тебе нужно провести анализ уязвимостей и подобраться к базе данных, чтобы нанести последний удар!"
    
    hide assistant
    hide hero
    with dissolve
    
    # Викторина: анализ уязвимостей
    python:
        analysis_quiz = {
            "title": "АНАЛИЗ: Уязвимости систем",
            "lives": 3,
            "questions": [
                ("Что такое SQL-инъекция?", ("Укол в базу данных", "Атака через уязвимости в запросах", "Вид антивируса", "Медицинская процедура"), 1),
                ("Что означает DoS-атака?", ("Операционная система", "Атака отказа в обслуживании", "Антивирусная программа", "Игровой режим"), 1),
                ("Какой протокол безопаснее?", ("HTTP", "FTP", "HTTPS", "TELNET"), 2),
                ("Что такое zero-day уязвимость?", ("Старая ошибка", "Неизвестная разработчикам уязвимость", "Вирус", "Обновление"), 1),
                ("Для чего нужен VPN?", ("Для игр", "Для анонимности и защиты данных", "Для ускорения", "Для музыки"), 1),
            ]
        }
    
    call quiz_game(analysis_quiz)
    return


# ============================================================================
# СЦЕНА 8: Успех анализа и нападение хакера
# ============================================================================
# Герой получает доступ, но хакер атакует и "стирает" помощника.
label prologue_scene_8_hacker_attack:
    scene bgMainCRT with dissolve
    show hero smile at right with dissolve
    
    h "Отлично, у меня получилось!"
    h "Доступ получен!"
    
    show assistant smile at assistantPos with dissolve
    a "Хорошо, осталс—…"
    
    # Хакер стирает помощника
    hide assistant with Dissolve(0.2)
    with vpunch
    
    show hacker idle at center with dissolve
    x "ОП! Что, не ждали?"
    
    h "ЧТО ТЫ СДЕЛАЛ?!?"
    x "Да так, начал потихоньку подчищать файлы, а что — не нравится?"
    x "Сразу так тихо стало."
    x "Хорошо так."
    h "Ты за все ответишь!!!"
    x "Хорошо, жду."
    
    hide hacker
    hide hero
    with dissolve
    return


# ============================================================================
# СЦЕНА 9: Помощник в глитч-форме
# ============================================================================
# Помощник возвращается, но в поврежденном состоянии. Дает последние инструкции.
label prologue_scene_9_glitched_assistant:
    scene bgMainCRT with dissolve
    show hero idle at right with dissolve
    
    h "{i}Что же мне теперь делать…{/i}"
    
    # Помощник появляется с глитч-эффектом
    show assistant surprised at assistantPos with Dissolve(0.2)
    hide assistant with Dissolve(0.1)
    show assistant surprised at assistantPos with Dissolve(0.1)
    
    a "Тебе осталось немного…"
    h "Ты еще жива!!!"
    a "Ненадолго, но времени хватит…"
    a "Тебе осталось получить доступ к базе данных."
    a "И помни — он тебя ждет…"
    a "Я в тебя верю…"
    
    hide assistant with Dissolve(0.5)
    hide hero with dissolve
    return


# ============================================================================
# СЦЕНА 10: Путь к данным
# ============================================================================
# Герой направляется к базе данных с решимостью закончить с хакером.
label prologue_scene_10_journey_to_data:
    scene bgMainCRT with dissolve
    show hero idle at center with dissolve
    
    h "Я не подведу."
    
    scene bgMainCRT with Dissolve(0.5)
    show hero idle at center with dissolve
    
    h "{i}Что ж… ну вот я и пришел к данным. Пора заканчивать с хакером.{/i}"
    
    hide hero with dissolve
    return


# ============================================================================
# СЦЕНА 11: Финальное противостояние (мини-игра бой)
# ============================================================================
# Герой встречается с хакером для финального боя.
label prologue_scene_11_final_confrontation:
    scene bgMainCRT with dissolve
    show hacker idle at left with dissolve:
        xzoom -1
    show hero idle at right with dissolve
    
    x "О, ты все-таки пришел."
    x "Я уж начал думать, что без своей подружки не дойдешь."
    h "Я заберу данные и восстановлю ее!"
    x "Слишком много о себе думаешь."
    x "Я уже запустил процесс форматирования, и скоро он дойдет и до твоего сознания."
    x "Для тебя это конец! Смирись."
    h "Нет, я не позволю тебе и дальше терроризировать людей."
    h "Ты слишком опасен."
    x "Ну что же, если так хочешь…"
    x "Станцуем!"
    
    hide hacker
    hide hero
    with dissolve
    
    # Вызов мини-игры боя (Space Shooter) — финальный бой
    call game_space_shooter(return_to_caller=True)
    
    # После возврата из мини-игры показываем концовку
    jump prologue_ending


# ============================================================================
# СЦЕНА 12: Концовка пролога
# ============================================================================
# Финальная сцена после боя с хакером
label prologue_ending:
    scene bgMainCRT with Dissolve(1.0)
    
    # Проверяем результат игры (победа или поражение)
    if ship_data["lives"] > 0:
        # Победная концовка
        show hero smile at center with dissolve
        h "{i}Я... я смог!{/i}"
        
        show assistant smile at assistantPos with dissolve
        a "Ты молодец! Ты победил хакера и вернул свои данные!"
        a "Теперь твое сознание может вернуться в тело."
        
        show hacker idle at right with dissolve
        x "Невозможно... Как ты смог меня победить?!"
        h "Потому что я боролся за свою жизнь и за безопасность других людей!"
        x "Это... это не конец..."
        
        hide hacker with Dissolve(0.5)
        
        a "Не волнуйся, я восстановлю все твои данные."
        a "Скоро ты проснешься в своем теле."
        h "Спасибо тебе за все! Без тебя я бы не справился."
        a "Всегда рада помочь. Удачи в реальном мире!"
        
        scene bgBlack with Dissolve(2.0)
        show expression Solid("#00000080") as prolog_overlay
        centered "{=prolog_narrator}ПОБЕДА!{/=}"
        pause 2.0
        centered "{=prolog_narrator}Герой вернулся в свое тело и предупредил всех об опасности.{/=}"
        pause 3.0
        centered "{=prolog_narrator}Хакер был остановлен, и больше никто не пострадал от его вируса.{/=}"
        pause 3.0
        centered "{=prolog_narrator}КОНЕЦ ПРОЛОГА{/=}"
        pause 2.0
        hide prolog_overlay
        
    else:
        # Концовка поражения
        scene bgMainCRT with Dissolve(0.5)
        show hero idle at center with dissolve
        
        h "{i}Мне не удалось... Я проиграл...{/i}"
        
        show hacker idle at left with dissolve
        x "Ха-ха-ха! Я же говорил, что ты не справишься!"
        x "Твое сознание останется здесь навсегда!"
        
        # Глитч-помощник пытается помочь
        show assistant surprised at assistantPos with Dissolve(0.2)
        hide assistant with Dissolve(0.1)
        show assistant surprised at assistantPos with Dissolve(0.1)
        
        a "Нет... Я не могу... позволить... этому случиться..."
        a "У меня осталось немного энергии..."
        a "Я... отправлю тебя... обратно..."
        
        h "Нет! Не делай этого! Ты можешь не выжить!"
        a "Это... моя миссия... Защищать... людей..."
        a "Прощай... друг..."
        
        hide assistant with Dissolve(1.0)
        hide hacker with dissolve
        hide hero with dissolve
        
        scene bgBlack with Dissolve(2.0)
        show expression Solid("#00000080") as prolog_overlay
        centered "{=prolog_narrator}ПОРАЖЕНИЕ{/=}"
        pause 2.0
        centered "{=prolog_narrator}Помощник пожертвовала собой, чтобы вернуть героя в реальный мир.{/=}"
        pause 3.0
        centered "{=prolog_narrator}Герой проснулся в своем теле, но хакер все еще на свободе...{/=}"
        pause 3.0
        centered "{=prolog_narrator}История продолжится...{/=}"
        pause 2.0
        hide prolog_overlay
    
    # Возврат в главное меню
    return


# ============================================================================
# ГЛАВНЫЙ МОДУЛЬ ПРОЛОГА
# ============================================================================
# Этот ярлык последовательно вызывает все сцены пролога
label prologue_main:
    # Часть 1: До оцифровки (на фоне prolog-bg)
    call prologue_scene_0a_intro
    call prologue_scene_0b_home
    call prologue_scene_0c_game_choice
    
    # Запуск Space Shooter (первая игра)
    call game_space_shooter(return_to_caller=True)
    
    # Встреча с хакером и оцифровка
    call prologue_scene_0d_hacker_appears
    
    # Часть 2: После оцифровки (на фоне main_background_crt)
    scene bgMainCRT with Dissolve(1.0)
    
    call prologue_scene_1_awakening
    call prologue_scene_2_meeting_assistant
    call prologue_scene_3_rescue_plan
    call prologue_scene_4_reconnaissance_prep
    call prologue_scene_5_reconnaissance_results
    call prologue_scene_6_hacker_threat
    call prologue_scene_7_analysis_prep
    call prologue_scene_8_hacker_attack
    call prologue_scene_9_glitched_assistant
    call prologue_scene_10_journey_to_data
    call prologue_scene_11_final_confrontation
    return
